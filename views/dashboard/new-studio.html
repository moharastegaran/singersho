<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
    <title>پنل کاربری - افزودن استادیو </title>
    <link rel="icon" type="image/x-icon" href="../../assets/img/favicon.ico"/>
    <link href="../../assets/scss/loader.css" rel="stylesheet" type="text/css"/>
    <script src="../../assets/js/loader.js"></script>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <!--<link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">-->
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="../../assets/scss/plugins.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->

    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM STYLES -->
    <link rel="stylesheet" type="text/css" href="../../assets/scss/forms/switches.min.css">
    <link rel="stylesheet" type="text/css" href="../../plugins/file-upload/file-upload-with-preview.min.css">
    <link rel="stylesheet" type="text/css" href="../../plugins/snackbar/snackbar.min.css">

    <style>
        .form-group {
            position: relative;
        }

        .form-group svg, .form-group svg {
            position: absolute;
            width: 20px;
            top: 11px;
            right: 9px;
            color: #8dbf42;
            fill: rgba(43, 226, 47, 0.24);
        }

        .form-group input, .form-group textarea {
            padding-right: 35px;
            border: none;
            border-bottom: 1px solid #191e3a;
            border-radius: 0;
        }

        .form-group input.form-control:focus, .form-group input.form-control:focus {
            box-shadow: none;
        }
    </style>
    <!-- END PAGE LEVEL PLUGINS/CUSTOM STYLES -->

</head>
<body>
<!-- BEGIN LOADER -->
<div id="load_screen">
    <div class="loader">
        <div class="loader-content">
            <div class="spinner-grow align-self-center"></div>
        </div>
    </div>
</div>
<!--  END LOADER -->

<!--  BEGIN NAVBAR  -->
<header></header>
<!--  END NAVBAR  -->

<!--  BEGIN MAIN CONTAINER  -->
<div class="main-container" id="container">

    <div class="overlay"></div>
    <div class="search-overlay"></div>

    <!--  BEGIN SIDEBAR  -->
    <aside></aside>
    <!--  END SIDEBAR  -->

    <!--  BEGIN CONTENT AREA  -->
    <div id="content" class="main-content">
        <div class="layout-px-spacing">
            <div class="row layout-top-spacing">
                <div class="col-xl-10 col-lg-11 col-sm-12 mx-auto layout-spacing">
                    <div class="widget-content widget-content-area br-6">
                        <form id="formAddStudio" class="row mt-0" enctype="multipart/form-data">
                            <div class="col-md-8 col-sm-10 mx-auto mb-5">
                                <div class="custom-file-container" data-upload-id="studioImagesFileContainer">
                                    <label>آپلود عکس(ها) <a href="javascript:void(0)"
                                                            class="custom-file-container__image-clear"
                                                            title="حذف عکس">x</a></label>
                                    <label class="custom-file-container__custom-file">
                                        <input type="file" class="custom-file-container__custom-file__custom-file-input"
                                               multiple>
                                        <input type="hidden" name="MAX_FILE_SIZE" value="10485760"/>
                                        <span class="custom-file-container__custom-file__custom-file-control"></span>
                                    </label>
                                    <div class="custom-file-container__image-preview"></div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class="feather feather-terminal">
                                        <polyline points="4 17 10 11 4 5"></polyline>
                                        <line x1="12" y1="19" x2="20" y2="19"></line>
                                    </svg>
                                    <input type="text" class="form-control mb-2" id="studioNameInput" name="name"
                                           placeholder="نام استادیو">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                         viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                         stroke-linecap="round" stroke-linejoin="round"
                                         class="feather feather-at-sign">
                                        <circle cx="12" cy="12" r="4"></circle>
                                        <path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"></path>
                                    </svg>
                                    <input type="text" class="form-control mb-2" id="studioRentCostInput"
                                           autocomplete="off" placeholder="هزینه اجاره(ساعتی)" name="price">
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round"
                                         class="feather feather-map-pin">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <textarea class="form-control" id="studioGeoLocationTextArea" rows="3"
                                              style="resize: none;" name="address" autocomplete="off"
                                              placeholder="آدرس دقیق استادیو را وارد کنید"></textarea>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-group">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" viewBox="0 0 24 24" fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round"
                                         class="feather feather-map-pin">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                    <textarea class="form-control mb-4" id="studioExtraDescriptionTextArea" rows="3"
                                              style="resize: none;" name="description" autocomplete="off"
                                              placeholder="توضیحات تکمیلی استادیو(اختیاری)"></textarea>
                                </div>
                            </div>
                            <div class="col-12 mb-3">
                                <button type="submit" class="btn btn-outline-primary mt-2 mb-2 btn-block">افزودن استادیو
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <footer></footer>
        <!--  END CONTENT AREA  -->

    </div>
</div>
<!-- END MAIN CONTAINER -->

<!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
<script src="../../assets/js/libs/jquery-3.1.1.min.js"></script>
<script src="../../bootstrap/js/popper.min.js"></script>
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<script src="../../plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="../../assets/js/app.js"></script>
<script src="../../assets/js/custom.js"></script>
<!-- END GLOBAL MANDATORY SCRIPTS -->

<!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
<script src="../../plugins/file-upload/file-upload-with-preview.min.js"></script>
<script src="../../plugins/snackbar/snackbar.min.js"></script>
<script src="../../assets/js/elements/custom-snackbar.js"></script>
<script>
    let studioMultiFileUploadContainer = new FileUploadWithPreview('studioImagesFileContainer');

    $("#formAddStudio").on("submit", function (e) {
        e.preventDefault();

        $.ajax({
            async: false,
            method: "POST",
            url: "http://127.0.0.1:8000/api/studio/register",
            headers: {
                authorization: "Bearer " + localStorage.getItem("accessToken")
            },
            data: {
                name: $("input[name='name']").val(),
                price: $("input[name='price']").val(),
                address: $("textarea[name='address']").val(),
            },
            error: function (error) {
                console.log("error : " + JSON.stringify(error))
            },
            success: function (response) {
                if (typeof response === 'object' && response !== null) {
                    if (!response.error) {
                        const studioImages = $("input[type='file']").get(0).files;
                        if (studioImages.length > 0) {
                            let isOk = true;
                            for (let i = 0; i < studioImages.length; i++) {
                                let formData = new FormData();
                                formData.append("name", "");
                                formData.append("description", "");
                                formData.append("image", studioImages[i]);
                                $.ajax({
                                    method: "POST",
                                    url: "http://127.0.0.1:8000/api/studio/" + response.studio.id + "/image",
                                    headers: {
                                        authorization: "Bearer " + localStorage.getItem("accessToken"),
                                    },
                                    data: formData,
                                    contentType: false,
                                    cache: false,
                                    processData: false,
                                    success: function (response) {
                                        if (typeof response === 'object' && response !== null) {
                                            if (response.error) {
                                                isOk = false;
                                                console.log(JSON.stringify(response));
                                                Snackbar.show({
                                                    text: response.messages[0],
                                                    actionText: '',
                                                    backgroundColor: "#cb1213",
                                                    pos: 'bottom-right'
                                                });
                                            }
                                        }
                                    },
                                });
                            }
                            if (isOk) {
                                Snackbar.show({
                                    text: 'استادیو شما با موفقیت ایجاد شد',
                                    actionText: 'تشکر',
                                    actionTextColor: '#1f8a02',
                                    onClose : function (element) {
                                        $(location).attr("href","studio.html");
                                    }
                                });
                            }
                        }
                    } else {
                        const messages = response.messages;
                        Snackbar.show({
                            text: messages[0],
                            actionText: '',
                            backgroundColor: "#cb1213",
                            pos: 'bottom-right'
                        });
                    }
                }
            }
        });
    });
</script>
<!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->

</body>
</html>
